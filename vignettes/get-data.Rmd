---
title: "Get Bioko data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Get Bioko data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(popbioko)
library(sp)
library(sf)
library(GISTools)
```

This shows how to get the incoming data and takes a look at it.

If you have an account at IHME, the following will copy files to
your local drive, under the data directory:
```{r}
download_worldpop()
download_bioko_grids()
download_hrsl_points()
```

The Bioko grids define cells where BIMEP assigns residents of
the island. One is a 1 km grid, the other a 100 m grid.
If we read those grids, we can see that the input files
are projected into UTM 32N, which makes all distances in meters.
That's very convenient, but the original grids were defined as
a regular grid in latitude and longitude.
```{r}
grids <- read_bioko_grids()
grid_info <- parameters_of_km_grid(grids$coarse, unproject = TRUE)
```
If we want to make such a grid, we could use
```{r}
dimensions <- c(grid_info$x_count, grid_info$y_count)
coarse_grid_copy <- make_fresh_grid(grid_info$bbox, dimensions)
```
We can show the original and copy in unprojected space.
```{r}
grid_1km <- sf::st_transform(grids$coarse, crs = "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs")
tm_shape(coarse_grid_copy) + tm_polygons(alpha = 0.1, border.col = "red") + tm_shape(grid_1km) + tm_polygons(alpha = 0.0, border.col = "blue")
```



```{r}
library(tmap)
hrsl_raster <- read_hrsl()
hrsl_points_sf <- hrsl_points(hrsl_raster)
hrsl_points_sf[is.na(hrsl_points_sf[[1]]), 1] <- 0
grids$coarse["hrsl"] <- hrsl_points_sf[[1]]
tm_shape(grids$coarse[grids$coarse$hrsl > 0,]) + tm_polygons("hrsl", title = "HRSL", palette = "Greens", style = "log10") + tm_layout(legend.title.size = 1, legend.text.size = 1)
```

